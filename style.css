/* 1. Aligner le dos à la base 0 */
.env-back {
    position: absolute;
    inset: 0;
    background: url('back.png') center/cover no-repeat;
    transform: translateZ(0px); /* Base de référence */
}

/* 2. Le rabat doit pivoter au même niveau que le dos pour éviter le gap */
.env-flap-container {
    position: absolute;
    inset: 0;
    transform-origin: top;
    z-index: 20;
    transform-style: preserve-3d;
    /* On le place à 0.1px du dos pour éviter le clignotement (z-fighting) */
    transform: rotateX(0deg) translateZ(0.1px); 
    transition: transform 1s ease-in-out, z-index 0s 0.8s;
}

/* L'état ouvert ne doit pas changer le translateZ, seulement la rotation */
.envelope.is-opened .env-flap-container {
    transform: rotateX(180deg) translateZ(0.1px);
    z-index: 2;
}

/* 3. Ajuster la carte et le devant pour qu'ils soient entre le dos et le rabat fermé */
.card {
    position: absolute;
    top: 10px;
    left: 50%;
    width: 90%;
    aspect-ratio: 1 / 1.1;
    background: white;
    z-index: 5;
    border-radius: 12px;
    /* La carte est à 1px de profondeur */
    transform: translate(-50%, 200%) translateZ(1px); 
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    transition: transform 1.2s cubic-bezier(0.34, 1.1, 0.64, 1);
    overflow: hidden;
}

.card.is-visible { transform: translate(-50%, -30px) translateZ(1px); }
.card.is-centered { transform: translate(-50%, -40vh) translateZ(1px); }

.env-front {
    position: absolute;
    inset: 0;
    z-index: 10;
    background: url('front.png') center/cover no-repeat;
    /* Le devant est à 2px de profondeur pour couvrir la carte */
    transform: translateZ(2px); 
}